<!DOCTYPE html>
<html lang="en">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">

  <meta http-equiv='Content-Type' content='text/html; charset=utf-8' />
  
  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Wrong Abstraction &middot; Ruby Developer
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="http://vpfaulkner.github.io/public/css/poole.css">
  <link rel="stylesheet" href="http://vpfaulkner.github.io/public/css/syntax.css">
  <link href='http://fonts.googleapis.com/css?family=Lora' rel='stylesheet'
  type='text/css'>

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://vpfaulkner.github.io/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="http://vpfaulkner.github.io/public/favicon.ico">
  <link rel="stylesheet" href="/public/font-awesome-4.3.0/css/font-awesome.min.css">

  <!-- RSS -->
  <link rel="alternate" type="application/atom+xml" title="Wrong Abstraction" href="http://vpfaulkner.github.io/atom.xml">
</head>


  <body>


    <div class="container content">
      <header class="masthead">
        <h3 class="masthead-title">
          <a href="http://vpfaulkner.github.io/" title="Home"><i class="fa
          fa-paper-plane"></i><span style="margin-left: .75rem">Wrong Abstraction</span></a>

          
             &nbsp;&nbsp;&nbsp;
             <small><a href="/about_me">About Me</a></small>
          
             &nbsp;&nbsp;&nbsp;
             <small><a href="/playbook">Playbook</a></small>
          
             &nbsp;&nbsp;&nbsp;
             <small><a href="/archive">Archive</a></small>
          

        </h3>
      </header>

      <main>
        <div class="posts">
  
  <article class="post">
    <h1 class="post-title">
      <a href="/2015/03/03/ruby-errors/">
        Ruby Errors
      </a>
    </h1>

    <time datetime="2015-03-03T00:00:00-05:00" class="post-date">03 Mar 2015</time>

    <p>Rescue clauses should not be used recklessly in your code because they might make important bugs in your code hard to find. But in certain situations, particularly when your code deals with an external service that you can’t control, they become critical.</p>

<p>In it’s simplest and most common form you can simply insert a rescue that rescues StandardError (don’t ever rescue from Exception as it can prevent much more important errors from coming to your attention!). See below:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">post</span>
  <span class="k">begin</span>
    <span class="nb">puts</span> <span class="s2">&quot;About to send&quot;</span>
    <span class="c1"># HTTP Post logic</span>
  <span class="k">rescue</span> <span class="o">=&gt;</span> <span class="n">e</span>
    <span class="nb">puts</span> <span class="s2">&quot;rescued from </span><span class="si">#{</span><span class="n">e</span><span class="o">.</span><span class="n">inspect</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="c1"># Other rescue logic</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></div>

<p>Here we have several things going on: a begin which marks the block you wish to rescue from (and the block which you might want to retry, see below), then the http post logic, and then logic to be executed upon rescue with e now holding the error information. I choose http post logic as an example because it is the very scenario that I see as commonly requiring rescue. For example, if the server receiving your post goes down or times out, you don’t want your program to crash. Instead, you should decide on how you want to handle these errors in advance and add that logic here.</p>

<p>If you want to retry the post you can do so:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">post</span>
  <span class="k">begin</span>
    <span class="nb">puts</span> <span class="s2">&quot;About to send&quot;</span>
    <span class="c1"># HTTP Post logic</span>
  <span class="k">rescue</span> <span class="o">=&gt;</span> <span class="n">e</span>
    <span class="nb">puts</span> <span class="s2">&quot;rescued from </span><span class="si">#{</span><span class="n">e</span><span class="o">.</span><span class="n">inspect</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">retry_count</span> <span class="p">?</span> <span class="n">retry_count</span> <span class="o">+=</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">retry_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">retry</span> <span class="k">if</span> <span class="n">retry_count</span> <span class="o">&lt;</span> <span class="mi">3</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></div>

<p>Here retry will go to the begin statement and retry the post. To prevent infinite retries, however, we are using a retry_count variable.</p>

<p>You can also include else logic when the rescue clause is not executed and/or ensure logic that will be executed no matter what:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">post</span>
  <span class="k">begin</span>
    <span class="nb">puts</span> <span class="s2">&quot;About to send&quot;</span>
    <span class="c1"># HTTP Post logic</span>
  <span class="k">rescue</span> <span class="o">=&gt;</span> <span class="n">e</span>
    <span class="nb">puts</span> <span class="s2">&quot;rescued from </span><span class="si">#{</span><span class="n">e</span><span class="o">.</span><span class="n">inspect</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">retry_count</span> <span class="p">?</span> <span class="n">retry_count</span> <span class="o">+=</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">retry_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">retry</span> <span class="k">if</span> <span class="n">retry_count</span> <span class="o">&lt;</span> <span class="mi">3</span>
  <span class="k">else</span>
    <span class="nb">puts</span> <span class="s2">&quot;success!&quot;</span>
  <span class="k">ensure</span>
    <span class="c1"># Ensure something is logged</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></div>

<p>Finally, it is OK to raise your own errors, particularly if a dependency is acting improperly:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">post</span>
  <span class="k">begin</span>
    <span class="nb">puts</span> <span class="s2">&quot;About to send&quot;</span>
    <span class="c1"># response = HTTP Post logic</span>
    <span class="k">raise</span> <span class="s2">&quot;BadResponseError&quot;</span> <span class="k">unless</span> <span class="n">response</span> <span class="o">==</span> <span class="mi">201</span>
  <span class="k">rescue</span> <span class="no">BadResponseError</span>
    <span class="c1"># Log bad response</span>
  <span class="k">rescue</span> <span class="o">=&gt;</span> <span class="n">e</span>
    <span class="nb">puts</span> <span class="s2">&quot;rescued from </span><span class="si">#{</span><span class="n">e</span><span class="o">.</span><span class="n">inspect</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">retry_count</span> <span class="p">?</span> <span class="n">retry_count</span> <span class="o">+=</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">retry_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">retry</span> <span class="k">if</span> <span class="n">retry_count</span> <span class="o">&lt;</span> <span class="mi">3</span>
  <span class="k">else</span>
    <span class="nb">puts</span> <span class="s2">&quot;success!&quot;</span>
  <span class="k">ensure</span>
    <span class="c1"># Ensure something is logged</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></div>

<p>Here we are treating undesired responses as an error and rescuing that specific error before a general rescue. Note that if you want to handle certain errors differently than others you should rescue them first.</p>

  </article>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="http://vpfaulkner.github.io/page4">Older</a>
  
  
    
      <a class="pagination-item newer" href="http://vpfaulkner.github.io/page2">Newer</a>
    
  
</div>

        

      </main>

      <footer class="footer">
        <small>
          &copy; <time datetime="2015-03-12T07:39:03-04:00">2015</time>. All rights reserved.
        </small>
      </footer>
    </div>

  </body>
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-60674340-1', 'auto');
    ga('send', 'pageview');

</script>

</html>
