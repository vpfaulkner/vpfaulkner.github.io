<p>Rescue clauses should not be used recklessly in your code because they might make important bugs in your code hard to find. But in certain situations, particularly when your code deals with an external service that you can’t control, they become critical.</p>

<p>In it’s simplest and most common form you can simply insert a rescue that rescues StandardError (don’t ever rescue from Exception as it can prevent much more important errors from coming to your attention!). See below:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">post</span>
  <span class="k">begin</span>
    <span class="nb">puts</span> <span class="s2">"About to send"</span>
    <span class="c1"># HTTP Post logic</span>
  <span class="k">rescue</span> <span class="o">=&gt;</span> <span class="n">e</span>
    <span class="nb">puts</span> <span class="s2">"rescued from </span><span class="si">#{</span><span class="n">e</span><span class="p">.</span><span class="nf">inspect</span><span class="si">}</span><span class="s2">"</span>
    <span class="c1"># Other rescue logic</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure>

<p>Here we have several things going on: a begin which marks the block you wish to rescue from (and the block which you might want to retry, see below), then the http post logic, and then logic to be executed upon rescue with e now holding the error information. I choose http post logic as an example because it is the very scenario that I see as commonly requiring rescue. For example, if the server receiving your post goes down or times out, you don’t want your program to crash. Instead, you should decide on how you want to handle these errors in advance and add that logic here.</p>

<p>If you want to retry the post you can do so:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">post</span>
  <span class="k">begin</span>
    <span class="nb">puts</span> <span class="s2">"About to send"</span>
    <span class="c1"># HTTP Post logic</span>
  <span class="k">rescue</span> <span class="o">=&gt;</span> <span class="n">e</span>
    <span class="nb">puts</span> <span class="s2">"rescued from </span><span class="si">#{</span><span class="n">e</span><span class="p">.</span><span class="nf">inspect</span><span class="si">}</span><span class="s2">"</span>
    <span class="n">retry_count</span> <span class="p">?</span> <span class="n">retry_count</span> <span class="o">+=</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">retry_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">retry</span> <span class="k">if</span> <span class="n">retry_count</span> <span class="o">&lt;</span> <span class="mi">3</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure>

<p>Here retry will go to the begin statement and retry the post. To prevent infinite retries, however, we are using a retry_count variable.</p>

<p>You can also include else logic when the rescue clause is not executed and/or ensure logic that will be executed no matter what:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">post</span>
  <span class="k">begin</span>
    <span class="nb">puts</span> <span class="s2">"About to send"</span>
    <span class="c1"># HTTP Post logic</span>
  <span class="k">rescue</span> <span class="o">=&gt;</span> <span class="n">e</span>
    <span class="nb">puts</span> <span class="s2">"rescued from </span><span class="si">#{</span><span class="n">e</span><span class="p">.</span><span class="nf">inspect</span><span class="si">}</span><span class="s2">"</span>
    <span class="n">retry_count</span> <span class="p">?</span> <span class="n">retry_count</span> <span class="o">+=</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">retry_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">retry</span> <span class="k">if</span> <span class="n">retry_count</span> <span class="o">&lt;</span> <span class="mi">3</span>
  <span class="k">else</span>
    <span class="nb">puts</span> <span class="s2">"success!"</span>
  <span class="k">ensure</span>
    <span class="c1"># Ensure something is logged</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure>

<p>Finally, it is OK to raise your own errors, particularly if a dependency is acting improperly:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">post</span>
  <span class="k">begin</span>
    <span class="nb">puts</span> <span class="s2">"About to send"</span>
    <span class="c1"># response = HTTP Post logic</span>
    <span class="k">raise</span> <span class="s2">"BadResponseError"</span> <span class="k">unless</span> <span class="n">response</span> <span class="o">==</span> <span class="mi">201</span>
  <span class="k">rescue</span> <span class="no">BadResponseError</span>
    <span class="c1"># Log bad response</span>
  <span class="k">rescue</span> <span class="o">=&gt;</span> <span class="n">e</span>
    <span class="nb">puts</span> <span class="s2">"rescued from </span><span class="si">#{</span><span class="n">e</span><span class="p">.</span><span class="nf">inspect</span><span class="si">}</span><span class="s2">"</span>
    <span class="n">retry_count</span> <span class="p">?</span> <span class="n">retry_count</span> <span class="o">+=</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">retry_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">retry</span> <span class="k">if</span> <span class="n">retry_count</span> <span class="o">&lt;</span> <span class="mi">3</span>
  <span class="k">else</span>
    <span class="nb">puts</span> <span class="s2">"success!"</span>
  <span class="k">ensure</span>
    <span class="c1"># Ensure something is logged</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure>

<p>Here we are treating undesired responses as an error and rescuing that specific error before a general rescue. Note that if you want to handle certain errors differently than others you should rescue them first.</p>
