<p>If you’re looking to run a background job in Ruby, one tool that I have found very easy to work with is Sidekiq. First off, how to use it:</p>

<p>Begin by adding it to your Gemfile:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">gem</span> <span class="s1">'sidekiq'</span></code></pre></figure>

<p>Install:</p>

<figure class="highlight"><pre><code class="language-sh" data-lang="sh">bundle install</code></pre></figure>

<p>Define the job you need done with a perform method:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/workers/email_worker.rb</span>
<span class="k">class</span> <span class="nc">EmailWorker</span>
  <span class="kp">include</span> <span class="no">Sidekiq</span><span class="o">::</span><span class="no">Worker</span>

  <span class="k">def</span> <span class="nf">perform</span><span class="p">(</span><span class="n">email</span><span class="p">)</span>
    <span class="c1"># Email logic</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure>

<p>And call the worker where appropriate</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">RegistrationController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

  <span class="k">def</span> <span class="nf">register</span>
    <span class="c1"># Registation Logic</span>
    <span class="no">EmailWorker</span><span class="p">.</span><span class="nf">perform_async</span><span class="p">(</span><span class="n">current_user</span><span class="p">.</span><span class="nf">email</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure>

<p>Get the Sidekiq process going from the shell in your root directory:</p>

<figure class="highlight"><pre><code class="language-sh" data-lang="sh">bundle <span class="nb">exec </span>sidekiq</code></pre></figure>

<p>Beyond knowing how to do Sidekiq for background processing, the question remains for when to use it.</p>

<p>For me Sidekiq (or any background job) is a trade-off of control and reliability for speed. Testing workers can be very difficult and trying to incorporate a complex workflow where certain actions must be kickedoff after the completion of multiple asynchronous processes can be unstable. Furthermore, it has an issue of thread saftey meaning you must use libraries in Sidekiq that are considered thread safe. For those whom this is a deal-breaker by the way, one other alternative is, <a href="https://github.com/resque/resque">Resque</a> which is a little slower but doesn’t require thread-safe code.</p>

<p>However, for a lot of situations such as the one here that involves sending an email in the background after registration, using a background job such as Sidekiq is perfect. In this case, any additional registration logic you want done does not have to wait for the email to be sent; furthermore, if you need to several things at once (such as emailing a larger mailing list) than doing that work in the background will allow you to make huge gains in speed.</p>
