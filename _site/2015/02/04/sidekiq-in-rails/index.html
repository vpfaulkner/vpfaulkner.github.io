<!DOCTYPE html>
<html lang="en">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">

  <meta http-equiv='Content-Type' content='text/html; charset=utf-8' />
  
  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Sidekiq in Rails &middot; Wrong Abstraction
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="http://vpfaulkner.github.io/public/css/poole.css">
  <link rel="stylesheet" href="http://vpfaulkner.github.io/public/css/syntax.css">
  <link href='http://fonts.googleapis.com/css?family=Lora' rel='stylesheet'
  type='text/css'>

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://vpfaulkner.github.io/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="http://vpfaulkner.github.io/public/favicon.ico">
  <link rel="stylesheet" href="/public/font-awesome-4.3.0/css/font-awesome.min.css">

  <!-- RSS -->
  <link rel="alternate" type="application/atom+xml" title="Wrong Abstraction" href="http://vpfaulkner.github.io/atom.xml">
</head>


  <body>


    <div class="container content">
      <header class="masthead">
        <h3 class="masthead-title">
          <a href="http://vpfaulkner.github.io/" title="Home"><i class="fa
          fa-paper-plane"></i><span style="margin-left: .75rem">Wrong Abstraction</span></a>

          
             &nbsp;&nbsp;&nbsp;
             <small><a href="/about_me">About Me</a></small>
          
             &nbsp;&nbsp;&nbsp;
             <small><a href="/playbook">Playbook</a></small>
          
             &nbsp;&nbsp;&nbsp;
             <small><a href="/archive">Archive</a></small>
          

        </h3>
      </header>

      <main>
        <article class="post">
  <h1 class="post-title">Sidekiq in Rails</h1>
  <time datetime="2015-02-04T00:00:00-05:00" class="page-date">04 Feb 2015</time>
  <p>If you’re looking to run a background job in Ruby, one tool that I have found very easy to work with is Sidekiq. First off, how to use it:</p>

<p>Begin by adding it to your Gemfile:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">gem</span> <span class="s1">&#39;sidekiq&#39;</span></code></pre></div>

<p>Install:</p>

<div class="highlight"><pre><code class="language-sh" data-lang="sh">bundle install</code></pre></div>

<p>Define the job you need done with a perform method:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/workers/email_worker.rb</span>
<span class="k">class</span> <span class="nc">EmailWorker</span>
  <span class="kp">include</span> <span class="no">Sidekiq</span><span class="o">::</span><span class="no">Worker</span>

  <span class="k">def</span> <span class="nf">perform</span><span class="p">(</span><span class="n">email</span><span class="p">)</span>
    <span class="c1"># Email logic</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></div>

<p>And call the worker where appropriate</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">RegistrationController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

  <span class="k">def</span> <span class="nf">register</span>
    <span class="c1"># Registation Logic</span>
    <span class="no">EmailWorker</span><span class="o">.</span><span class="n">perform_async</span><span class="p">(</span><span class="n">current_user</span><span class="o">.</span><span class="n">email</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></div>

<p>Get the Sidekiq process going from the shell in your root directory:</p>

<div class="highlight"><pre><code class="language-sh" data-lang="sh">bundle <span class="nb">exec </span>sidekiq</code></pre></div>

<p>Beyond knowing how to do Sidekiq for background processing, the question remains for when to use it. </p>

<p>For me Sidekiq (or any background job) is a trade-off of control and reliability for speed. Testing workers can be very difficult and trying to incorporate a complex workflow where certain actions must be kickedoff after the completion of multiple asynchronous processes can be unstable. Furthermore, it has an issue of thread saftey meaning you must use libraries in Sidekiq that are considered thread safe. For those whom this is a deal-breaker by the way, one other alternative is, <a href="https://github.com/resque/resque">Resque</a> which is a little slower but doesn’t require thread-safe code.</p>

<p>However, for a lot of situations such as the one here that involves sending an email in the background after registration, using a background job such as Sidekiq is perfect. In this case, any additional registration logic you want done does not have to wait for the email to be sent; furthermore, if you need to several things at once (such as emailing a larger mailing list) than doing that work in the background will allow you to make huge gains in speed.</p>

</article>

<aside class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="http://vpfaulkner.github.io//2015/03/02/structs-in-ruby/">
            Structs in Ruby
            <small><time datetime="2015-03-02T00:00:00-05:00">02 Mar 2015</time></small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="http://vpfaulkner.github.io//2015/02/23/wrap-your-dependencies/">
            Wrap Your Dependencies
            <small><time datetime="2015-02-23T00:00:00-05:00">23 Feb 2015</time></small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="http://vpfaulkner.github.io//2015/02/17/when-to-use-guard-statements/">
            When to use Guard Statements
            <small><time datetime="2015-02-17T00:00:00-05:00">17 Feb 2015</time></small>
          </a>
        </h3>
      </li>
    
  </ul>
</aside>

        
  <!-- Add Disqus comments. -->
  <div id="disqus_thread"></div>
  <script type="text/javascript">
    var disqus_shortname = 'vancefaulkner'; // required: replace example with your forum shortname
    var disqus_identifier = "/2015/02/04/sidekiq-in-rails/";

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
              var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
              dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
              (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


      </main>

      <footer class="footer">
        <small>
          &copy; <time datetime="2015-03-02T08:06:01-05:00">2015</time>. All rights reserved.
        </small>
      </footer>
    </div>

  </body>
</html>
