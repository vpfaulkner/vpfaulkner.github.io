<!DOCTYPE html>
<html lang="en">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">

  <meta http-equiv='Content-Type' content='text/html; charset=utf-8' />
  
  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Memoization in Ruby &middot; SimpleObjects
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="http://vpfaulkner.github.io/public/css/poole.css">
  <link rel="stylesheet" href="http://vpfaulkner.github.io/public/css/syntax.css">
  <link href='http://fonts.googleapis.com/css?family=Lora' rel='stylesheet'
  type='text/css'>

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://vpfaulkner.github.io/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="http://vpfaulkner.github.io/public/favicon.ico">
  <link rel="stylesheet" href="/public/font-awesome-4.3.0/css/font-awesome.min.css">

  <!-- RSS -->
  <link rel="alternate" type="application/atom+xml" title="SimpleObjects" href="http://vpfaulkner.github.io/atom.xml">
</head>


  <body>


    <div class="container content">
      <header class="masthead">
        <h3 class="masthead-title">
          <a href="http://vpfaulkner.github.io/" title="Home">SimpleObjects</a>

          
             &nbsp;&nbsp;&nbsp;
             <small><a href="/about_me">About Me</a></small>
          
             &nbsp;&nbsp;&nbsp;
             <small><a href="/playbook">Playbook</a></small>
          
             &nbsp;&nbsp;&nbsp;
             <small><a href="/archive">Archive</a></small>
          

        </h3>
      </header>

      <main>
        <article class="post">
  <h1 class="post-title">Memoization in Ruby</h1>
  <time datetime="2015-05-19T00:00:00-04:00" class="page-date">19 May 2015</time>

  <p>Let’s say you are relatively new to Rails and progressing through one of your first major Rails applications when you suddenly become conscious for the first time about performance. This happened to me when I was loading a large YAML file into memory and the app’s performance on the free Heroku account began to suffer.</p>

<p>Caching is one of the most difficult tasks in software development but in practice it can take a variety of techniques. One such technique is memoization: this involves essentially eagerly doing some computation up front and storing the result of that computation for later use. The key here is that the result of that work should not change and therefore caching it will not lead to misleading values. To illustrate this idea:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">pi_squared</span>
  <span class="no">Math</span><span class="o">::</span><span class="no">PI</span><span class="o">**</span><span class="mi">2</span>
<span class="k">end</span></code></pre></div>

<p>This is an overly simplified example but gets to the advantage of eagerly doing some work. If your program needed PI squared (for whatever reason, I do not know), then why would you want to compute that every time since it shouldn’t change?</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">pi_squared</span>
  <span class="vi">@pi_squared</span> <span class="o">||=</span> <span class="no">Math</span><span class="o">::</span><span class="no">PI</span><span class="o">**</span><span class="mi">2</span>
<span class="k">end</span></code></pre></div>

<p>For those that haven’t used this technique before in Ruby, it basically is shorthand for:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="vi">@pi_squared</span> <span class="o">=</span> <span class="vi">@pi_squared</span> <span class="o">||</span> <span class="no">Math</span><span class="o">::</span><span class="no">PI</span><span class="o">**</span><span class="mi">2</span></code></pre></div>

<p>Essentially that Math::PI**2 will only be executed the first time with the result saved to memory for later use.</p>

<p>Although this will technically save you time, real savings will come in queries to a database or external service:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">us_senators</span>
  <span class="vi">@us_senators</span> <span class="o">||=</span> <span class="no">SenatorAPIWrapper</span><span class="o">.</span><span class="n">get_senators</span>
<span class="k">end</span></code></pre></div>

<p>Here, you may be using an external service to query for all US Senators which can be expensive if you query multiple times. Moreover, the collection of senators rarely changes meaning it is very safe to assume what is saved in memory will remain correct. In other words, this is data that is perfect to cache because it is expensive to gather and rarely changes.</p>

<p>If you had to do some multiline queries you could accommodate that as well:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">congress</span>
  <span class="vi">@congress</span> <span class="o">||=</span> <span class="k">begin</span>
    <span class="n">senators</span> <span class="o">=</span> <span class="no">SenatorAPIWrapper</span><span class="o">.</span><span class="n">get_senators</span>
    <span class="n">representatives</span> <span class="o">=</span> <span class="no">RepresentativeAPIWrapper</span><span class="o">.</span><span class="n">get_representatives</span>
    <span class="n">senators</span><span class="o">.</span><span class="n">merge</span> <span class="n">representatives</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></div>

<p>These examples are very stripped down use-cases and only begin to get into the wide variety of caching techniques. Next on the list of things to research should be <a href="https://github.com/dkubb/memoizable">gem’s to memoize</a>, <a href="http://guides.rubyonrails.org/security.html">sessions in Rails</a>, and consideration also of when you should store something in a database vs in memory. However, the tradeoffs of caching are the same meaning you will always be trading how old data is versus how expensive it is to gather.</p>



  <ul class="share-buttons" style="list-style-type:none;display:inline;">
  <li><a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fsimpleobjects.io%2F&t=" title="Share on Facebook" target="_blank" onclick="window.open('https://www.facebook.com/sharer/sharer.php?u=' + encodeURIComponent(document.URL) + '&t=' + encodeURIComponent(document.URL)); return false;"><img src="http://simpleobjects.io/public/images/simple_icons_black/Facebook.png"></a></li>
  <li><a href="https://twitter.com/intent/tweet?source=http%3A%2F%2Fsimpleobjects.io%2F&text=:%20http%3A%2F%2Fsimpleobjects.io%2F" target="_blank" title="Tweet" onclick="window.open('https://twitter.com/intent/tweet?text=' + encodeURIComponent(document.title) + ':%20'  + encodeURIComponent(document.URL)); return false;"><img src="http://simpleobjects.io/public/images/simple_icons_black/Twitter.png"></a></li>
  <li><a href="https://plus.google.com/share?url=http%3A%2F%2Fsimpleobjects.io%2F" target="_blank" title="Share on Google+" onclick="window.open('https://plus.google.com/share?url=' + encodeURIComponent(document.URL)); return false;"><img src="http://simpleobjects.io/public/images/simple_icons_black/Google+.png"></a></li>
  <li><a href="http://www.tumblr.com/share?v=3&u=http%3A%2F%2Fsimpleobjects.io%2F&t=&s=" target="_blank" title="Post to Tumblr" onclick="window.open('http://www.tumblr.com/share?v=3&u=' + encodeURIComponent(document.URL) + '&t=' +  encodeURIComponent(document.title)); return false;"><img src="http://simpleobjects.io/public/images/simple_icons_black/Tumblr.png"></a></li>
  <li><a href="https://getpocket.com/save?url=http%3A%2F%2Fsimpleobjects.io%2F&title=" target="_blank" title="Add to Pocket" onclick="window.open('https://getpocket.com/save?url=' + encodeURIComponent(document.URL) + '&title=' +  encodeURIComponent(document.title)); return false;"><img src="http://simpleobjects.io/public/images/simple_icons_black/Pocket.png"></a></li>
  <li><a href="http://www.reddit.com/submit?url=http%3A%2F%2Fsimpleobjects.io%2F&title=" target="_blank" title="Submit to Reddit" onclick="window.open('http://www.reddit.com/submit?url=' + encodeURIComponent(document.URL) + '&title=' +  encodeURIComponent(document.title)); return false;"><img src="http://simpleobjects.io/public/images/simple_icons_black/Reddit.png"></a></li>
  <li><a href="http://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Fsimpleobjects.io%2F&title=&summary=&source=http%3A%2F%2Fsimpleobjects.io%2F" target="_blank" title="Share on LinkedIn" onclick="window.open('http://www.linkedin.com/shareArticle?mini=true&url=' + encodeURIComponent(document.URL) + '&title=' +  encodeURIComponent(document.title)); return false;"><img src="http://simpleobjects.io/public/images/simple_icons_black/LinkedIn.png"></a></li>
  <li><a href="mailto:?subject=&body=:%20http%3A%2F%2Fsimpleobjects.io%2F" target="_blank" title="Email" onclick="window.open('mailto:?subject=' + encodeURIComponent(document.title) + '&body=' +  encodeURIComponent(document.URL)); return false;"><img src="http://simpleobjects.io/public/images/simple_icons_black/Email.png"></a></li>
</ul>

</article>

<aside class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="http://vpfaulkner.github.io//2015/09/30/io-in-ruby/">
            IO in Ruby
            <small><time datetime="2015-09-30T00:00:00-04:00">30 Sep 2015</time></small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="http://vpfaulkner.github.io//2015/09/21/developer-to-engineer/">
            Developer to Engineer
            <small><time datetime="2015-09-21T00:00:00-04:00">21 Sep 2015</time></small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="http://vpfaulkner.github.io//2015/09/14/keyword-arguments-in-ruby/">
            Keyword Arguments in Ruby
            <small><time datetime="2015-09-14T00:00:00-04:00">14 Sep 2015</time></small>
          </a>
        </h3>
      </li>
    
  </ul>
</aside>

        

      </main>

      <footer class="footer">
        <small>
          &copy; <time datetime="2015-09-30T08:28:41-04:00">2015</time>. All rights reserved.
        </small>
      </footer>
    </div>

  </body>
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-60674340-1', 'auto');
    ga('send', 'pageview');

</script>

</html>
