<p>If you are going to embrace testing in Ruby you need to know RSpec, even if you prefer another testing tool such as MiniTest. RSpec is used widely and at many places testing is such a core part of the development process that knowing the basics of RSpec is essential.</p>

<p>That being said, RSpec provides a DSL (domain specific language) that is pretty extensive. The first thing you’ll notice if seeing an RSpec file for the first time is that everything seems to be divided into separate blocks of code starting with some kind of describe block:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">describe</span> <span class="c1">#my_method do</span>
  <span class="c1"># some tests</span>
<span class="k">end</span></code></pre></figure>

<p>So let’s start with the basics: the describe block here is not a test but a place to explicitly state what you are testing. Think about it as about it as a bucket of behavior for you to group tests in.</p>

<p>You might ask what the # is for. This is doing nothing special or behind the scenes; it is simply ruby convention for signifying an instance method. If you were testing a class method you could use a . instead.</p>

<p>Secondly, it is common to have describe blocks nested within each other:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">describe</span> <span class="no">MyClass</span> <span class="k">do</span>
  <span class="n">describe</span> <span class="c1">#my_method do</span>
    <span class="c1"># some tests</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure>

<p>Again, no tests yet, just a useful organizational framework to hold your tests.</p>

<p>Within a describe block you will often see a context block:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">describe</span> <span class="no">Song</span> <span class="k">do</span>
  <span class="n">describe</span> <span class="c1">#download do</span>

    <span class="n">context</span> <span class="s1">'when logged in'</span> <span class="k">do</span>
      <span class="c1"># some tests</span>
    <span class="k">end</span>

    <span class="n">context</span> <span class="s1">'when not logged in'</span> <span class="k">do</span>
      <span class="c1"># some tests</span>
    <span class="k">end</span>

  <span class="k">end</span>
<span class="k">end</span></code></pre></figure>

<p>Oftentimes desired behavior changes with context–that’s why we have context blocks. Context blocks are useful because we need to create the right context in order to test specific behavior we have to do some setup.</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">describe</span> <span class="no">Song</span> <span class="k">do</span>
  <span class="n">describe</span> <span class="c1">#download do</span>

    <span class="n">context</span> <span class="s1">'when logged in'</span> <span class="k">do</span>
      <span class="n">before</span> <span class="k">do</span>
        <span class="vi">@user</span> <span class="o">=</span> <span class="no">User</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s2">"Joe"</span><span class="p">)</span>
        <span class="vi">@user</span><span class="p">.</span><span class="nf">login</span>
        <span class="vi">@song</span> <span class="o">=</span> <span class="no">Song</span><span class="p">.</span><span class="nf">new</span>
      <span class="k">end</span>

      <span class="c1"># some tests</span>

    <span class="k">end</span>

    <span class="n">context</span> <span class="s1">'when not logged in'</span> <span class="k">do</span>
      <span class="n">before</span> <span class="k">do</span>
        <span class="vi">@user</span> <span class="o">=</span> <span class="no">User</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s2">"Joe"</span><span class="p">)</span>
        <span class="vi">@song</span> <span class="o">=</span> <span class="no">Song</span><span class="p">.</span><span class="nf">new</span>
      <span class="k">end</span>

      <span class="c1"># some tests</span>

    <span class="k">end</span>

  <span class="k">end</span>
<span class="k">end</span></code></pre></figure>

<p>As you can see here, we setup the test with another before block. Before blocks run before each test; this may seem silly here because we don’t have a lot of tests or setup but they quickly become useful as you add lots of tests that require the same context. The context for our to-be-written tests will be slightly different as written in the context block: the user will be logged in for one context and not logged in for another.</p>

<p>Finally, let’s add the actual tests:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">describe</span> <span class="no">Song</span> <span class="k">do</span>
  <span class="n">describe</span> <span class="c1">#download do</span>

    <span class="n">context</span> <span class="s1">'when logged in'</span> <span class="k">do</span>
      <span class="n">before</span> <span class="k">do</span>
        <span class="vi">@user</span> <span class="o">=</span> <span class="no">User</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s2">"Joe"</span><span class="p">)</span>
        <span class="vi">@user</span><span class="p">.</span><span class="nf">login</span>
        <span class="vi">@song</span> <span class="o">=</span> <span class="no">Song</span><span class="p">.</span><span class="nf">new</span>
      <span class="k">end</span>

      <span class="n">it</span> <span class="s1">'downloads song'</span> <span class="k">do</span>
        <span class="n">expect</span><span class="p">(</span><span class="vi">@song</span><span class="p">.</span><span class="nf">download</span><span class="p">).</span><span class="nf">to</span> <span class="n">change</span><span class="p">{</span><span class="vi">@user</span><span class="p">.</span><span class="nf">songs</span><span class="p">}.</span><span class="nf">by</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
      <span class="k">end</span>

    <span class="k">end</span>

    <span class="n">context</span> <span class="s1">'when not logged in'</span> <span class="k">do</span>
      <span class="n">before</span> <span class="k">do</span>
        <span class="vi">@user</span> <span class="o">=</span> <span class="no">User</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s2">"Joe"</span><span class="p">)</span>
        <span class="vi">@song</span> <span class="o">=</span> <span class="no">Song</span><span class="p">.</span><span class="nf">new</span>
      <span class="k">end</span>

      <span class="n">it</span> <span class="s1">'raises an error'</span> <span class="k">do</span>
        <span class="n">expect</span><span class="p">(</span><span class="vi">@song</span><span class="p">.</span><span class="nf">download</span><span class="p">).</span><span class="nf">to</span> <span class="n">raise_error</span><span class="p">(</span><span class="no">LoginError</span><span class="p">)</span>
      <span class="k">end</span>

    <span class="k">end</span>

  <span class="k">end</span>
<span class="k">end</span></code></pre></figure>

<p>The it block here is where the actual tests are. We are using the expect syntax over the older should syntax but both are valid. You can find ways to test a lot of different behavior which we will not go into here, but, as you can see, the expected behavior should be highlighted in the it block and appropriate for the given context.</p>

<p>There is a lot to learn with RSpec but with that learning curve comes flexibility to create very effective tests. Hopefully with these fundamental concepts you begin to understand the basics of what’s going on and easily incorporate TDD into your workflow.</p>
