<!DOCTYPE html>
<html lang="en">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">

  <meta http-equiv='Content-Type' content='text/html; charset=utf-8' />
  
  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Benchmarking in Ruby &middot; SimpleObjects
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="http://vpfaulkner.github.io/public/css/poole.css">
  <link rel="stylesheet" href="http://vpfaulkner.github.io/public/css/syntax.css">
  <link href='http://fonts.googleapis.com/css?family=Lora' rel='stylesheet'
  type='text/css'>

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://vpfaulkner.github.io/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="http://vpfaulkner.github.io/public/favicon.ico">
  <link rel="stylesheet" href="/public/font-awesome-4.3.0/css/font-awesome.min.css">

  <!-- RSS -->
  <link rel="alternate" type="application/atom+xml" title="SimpleObjects" href="http://vpfaulkner.github.io/atom.xml">
</head>


  <body>


    <div class="container content">
      <header class="masthead">
        <h3 class="masthead-title">
          <a href="http://vpfaulkner.github.io/" title="Home">SimpleObjects</a>

          
             &nbsp;&nbsp;&nbsp;
             <small><a href="/about_me">About Me</a></small>
          
             &nbsp;&nbsp;&nbsp;
             <small><a href="/playbook">Playbook</a></small>
          
             &nbsp;&nbsp;&nbsp;
             <small><a href="/archive">Archive</a></small>
          

        </h3>
      </header>

      <main>
        <article class="post">
  <h1 class="post-title">Benchmarking in Ruby</h1>
  <time datetime="2015-05-01T00:00:00-04:00" class="page-date">01 May 2015</time>
  <p>Benchmarking, <a href="/2015/04/08/basic-logging-in-ruby/">like logging</a>, deserves more attention than it currently gets. Unless your application is just getting off the ground with little or no usage, performance testing should accompany other functional tests (such as unit, and integration tests) as part of your continuous integration infrastructure.</p>

<p>Luckily, basic benchmarking is easy in Ruby via the built-in Benchmark module:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">require</span> <span class="s1">&#39;benchmark&#39;</span>

<span class="nb">puts</span> <span class="no">Benchmark</span><span class="o">.</span><span class="n">measure</span> <span class="p">{</span> <span class="mi">10_000_000</span><span class="o">.</span><span class="n">times</span> <span class="p">{</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span> <span class="n">i</span> <span class="o">**</span> <span class="mi">2</span> <span class="p">}</span> <span class="p">}</span></code></pre></div>

<p>This returns:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">0.900000   0.000000   0.900000 <span class="o">(</span>  0.902290<span class="o">)</span></code></pre></div>

<p>These represent (all in seconds):
* user CPU time
* system CPU time
* the sum of the user and system CPU times
* the elapsed real time</p>

<p>The last one is probably most important for you, the elapsed real time.</p>

<p>This syntax is ideal for very simple benchmarking where you might for example want to see how long a single method takes. However, a much more common need is to compare multiple approaches to the same problem to see which performs better:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">require</span> <span class="s1">&#39;benchmark&#39;</span>

<span class="n">array</span> <span class="o">=</span> <span class="nb">Array</span> <span class="p">(</span><span class="mi">1</span><span class="o">.</span><span class="n">.</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">set</span> <span class="o">=</span> <span class="no">Set</span><span class="o">.</span><span class="n">new</span> <span class="p">(</span><span class="mi">1</span><span class="o">.</span><span class="n">.</span><span class="mi">1000</span><span class="p">)</span>

<span class="no">Benchmark</span><span class="o">.</span><span class="n">bm</span> <span class="k">do</span> <span class="o">|</span><span class="n">x</span><span class="o">|</span>
  <span class="n">x</span><span class="o">.</span><span class="n">report</span> <span class="p">{</span> <span class="n">array</span><span class="o">.</span><span class="n">include?</span> <span class="mi">999</span> <span class="p">}</span>
  <span class="n">x</span><span class="o">.</span><span class="n">report</span> <span class="p">{</span> <span class="n">set</span><span class="o">.</span><span class="n">include?</span> <span class="mi">999</span> <span class="p">}</span>
<span class="k">end</span></code></pre></div>

<p>This returns:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">user     system      total        real
   0.000000   0.000000   0.000000 <span class="o">(</span>  0.000226<span class="o">)</span>
   0.000000   0.000000   0.000000 <span class="o">(</span>  0.000006<span class="o">)</span></code></pre></div>

<p>As you can see, the Array include? is a lot slower than the Set include? (a Set does not preserve original order so a binary search technique can be used when looking up items).</p>

<p>There are a number of more advanced options all available as part of the standard module and can be found <a href="http://ruby-doc.org/stdlib-1.9.3/libdoc/benchmark/rdoc/Benchmark.html">here</a>.</p>

</article>

<aside class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="http://vpfaulkner.github.io//2015/04/20/the-law-of-demeter/">
            The Law of Demeter
            <small><time datetime="2015-04-20T00:00:00-04:00">20 Apr 2015</time></small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="http://vpfaulkner.github.io//2015/04/17/what-is-the-enumerable-module/">
            What is the Enumerable Module in Ruby?
            <small><time datetime="2015-04-17T00:00:00-04:00">17 Apr 2015</time></small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="http://vpfaulkner.github.io//2015/04/08/basic-logging-in-ruby/">
            Basic Logging in Ruby
            <small><time datetime="2015-04-08T00:00:00-04:00">08 Apr 2015</time></small>
          </a>
        </h3>
      </li>
    
  </ul>
</aside>

        

      </main>

      <footer class="footer">
        <small>
          &copy; <time datetime="2015-05-01T08:38:04-04:00">2015</time>. All rights reserved.
        </small>
      </footer>
    </div>

  </body>
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-60674340-1', 'auto');
    ga('send', 'pageview');

</script>

</html>
