<!DOCTYPE html>
<html lang="en">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">

  <meta http-equiv='Content-Type' content='text/html; charset=utf-8' />
  
  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Module Configuration in Ruby &middot; SimpleObjects
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="http://vpfaulkner.github.io/public/css/poole.css">
  <link rel="stylesheet" href="http://vpfaulkner.github.io/public/css/syntax.css">
  <link href='http://fonts.googleapis.com/css?family=Lora' rel='stylesheet'
  type='text/css'>

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://vpfaulkner.github.io/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="http://vpfaulkner.github.io/public/favicon.ico">
  <link rel="stylesheet" href="/public/font-awesome-4.3.0/css/font-awesome.min.css">

  <!-- RSS -->
  <link rel="alternate" type="application/atom+xml" title="SimpleObjects" href="http://vpfaulkner.github.io/atom.xml">
</head>


  <body>


    <div class="container content">
      <header class="masthead">
        <h3 class="masthead-title">
          <a href="http://vpfaulkner.github.io/" title="Home">SimpleObjects</a>

          
             &nbsp;&nbsp;&nbsp;
             <small><a href="/about_me">About Me</a></small>
          
             &nbsp;&nbsp;&nbsp;
             <small><a href="/playbook">Playbook</a></small>
          
             &nbsp;&nbsp;&nbsp;
             <small><a href="/archive">Archive</a></small>
          

        </h3>
      </header>

      <main>
        <article class="post">
  <h1 class="post-title">Module Configuration in Ruby</h1>
  <time datetime="2015-08-18T00:00:00-04:00" class="page-date">18 Aug 2015</time>

  <p>Recently I wanted to introduce an object store wrapper to my application with a simple, singleton interface like the one below:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">ObjectStore</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">object</span><span class="p">)</span>
<span class="no">ObjectStore</span><span class="o">.</span><span class="n">retrieve</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span></code></pre></div>

<p>This object would not be instantiated and thus I started out with a module defining the two methods on the singleton instance:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">module</span> <span class="nn">ObjectStore</span>
  <span class="k">class</span> <span class="o">&lt;&lt;</span> <span class="nb">self</span>
    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">object</span><span class="p">)</span>
      <span class="c1"># write logic</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">retrieve</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
      <span class="c1"># retrieve logic</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></div>

<p>This allowed me to offer such an interface and for a while all seemed well. However, there soon became a need to ever-so-slightly configure this module. We wanted to be able to configure the connection to our object store service including the API keys required as part of that connection. Moreover, we wanted to be able to configure based on ENV variables and put the configuration code in our config.ru file that would be run upon booting up the app (this was a bare bones rack app that used rackup). We were picturing something like this:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># config.ru</span>
<span class="no">ObjectStore</span><span class="o">.</span><span class="n">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
  <span class="n">config</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;SL_USERNAME&#39;</span><span class="o">]</span>
  <span class="n">config</span><span class="o">.</span><span class="n">api_key</span>  <span class="o">=</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;API_KEY&#39;</span><span class="o">]</span>
<span class="k">end</span></code></pre></div>

<p>How could we accommodate this? Well the first thing we had to do is provide a configure method that yielded self to this block:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">module</span> <span class="nn">ObjectStore</span>
  <span class="k">class</span> <span class="o">&lt;&lt;</span> <span class="nb">self</span>
    <span class="k">def</span> <span class="nf">configure</span>
      <span class="k">yield</span> <span class="nb">self</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></div>

<p>The self of course is the ObjectStore singleton and by yielding it we can provide it to the given block (as we do with config in the example above) to do any configurations it deems necessary. Finally, we need to offer the configurable attributes as methods:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">module</span> <span class="nn">ObjectStore</span>
  <span class="k">class</span> <span class="o">&lt;&lt;</span> <span class="nb">self</span>
    <span class="kp">attr_accessor</span> <span class="ss">:username</span><span class="p">,</span> <span class="ss">:api_key</span>

    <span class="k">def</span> <span class="nf">configure</span>
      <span class="k">yield</span> <span class="nb">self</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></div>

<p>This cleanly allows us to both provide a singleton interface to the rest of the app as well as a way to the configure this object from the outside.</p>


  <ul class="share-buttons" style="list-style-type:none;display:inline;">
  <li><a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fsimpleobjects.io%2F&t=" title="Share on Facebook" target="_blank" onclick="window.open('https://www.facebook.com/sharer/sharer.php?u=' + encodeURIComponent(document.URL) + '&t=' + encodeURIComponent(document.URL)); return false;"><img src="http://simpleobjects.io/public/images/simple_icons_black/Facebook.png"></a></li>
  <li><a href="https://twitter.com/intent/tweet?source=http%3A%2F%2Fsimpleobjects.io%2F&text=:%20http%3A%2F%2Fsimpleobjects.io%2F" target="_blank" title="Tweet" onclick="window.open('https://twitter.com/intent/tweet?text=' + encodeURIComponent(document.title) + ':%20'  + encodeURIComponent(document.URL)); return false;"><img src="http://simpleobjects.io/public/images/simple_icons_black/Twitter.png"></a></li>
  <li><a href="https://plus.google.com/share?url=http%3A%2F%2Fsimpleobjects.io%2F" target="_blank" title="Share on Google+" onclick="window.open('https://plus.google.com/share?url=' + encodeURIComponent(document.URL)); return false;"><img src="http://simpleobjects.io/public/images/simple_icons_black/Google+.png"></a></li>
  <li><a href="http://www.tumblr.com/share?v=3&u=http%3A%2F%2Fsimpleobjects.io%2F&t=&s=" target="_blank" title="Post to Tumblr" onclick="window.open('http://www.tumblr.com/share?v=3&u=' + encodeURIComponent(document.URL) + '&t=' +  encodeURIComponent(document.title)); return false;"><img src="http://simpleobjects.io/public/images/simple_icons_black/Tumblr.png"></a></li>
  <li><a href="https://getpocket.com/save?url=http%3A%2F%2Fsimpleobjects.io%2F&title=" target="_blank" title="Add to Pocket" onclick="window.open('https://getpocket.com/save?url=' + encodeURIComponent(document.URL) + '&title=' +  encodeURIComponent(document.title)); return false;"><img src="http://simpleobjects.io/public/images/simple_icons_black/Pocket.png"></a></li>
  <li><a href="http://www.reddit.com/submit?url=http%3A%2F%2Fsimpleobjects.io%2F&title=" target="_blank" title="Submit to Reddit" onclick="window.open('http://www.reddit.com/submit?url=' + encodeURIComponent(document.URL) + '&title=' +  encodeURIComponent(document.title)); return false;"><img src="http://simpleobjects.io/public/images/simple_icons_black/Reddit.png"></a></li>
  <li><a href="http://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Fsimpleobjects.io%2F&title=&summary=&source=http%3A%2F%2Fsimpleobjects.io%2F" target="_blank" title="Share on LinkedIn" onclick="window.open('http://www.linkedin.com/shareArticle?mini=true&url=' + encodeURIComponent(document.URL) + '&title=' +  encodeURIComponent(document.title)); return false;"><img src="http://simpleobjects.io/public/images/simple_icons_black/LinkedIn.png"></a></li>
  <li><a href="mailto:?subject=&body=:%20http%3A%2F%2Fsimpleobjects.io%2F" target="_blank" title="Email" onclick="window.open('mailto:?subject=' + encodeURIComponent(document.title) + '&body=' +  encodeURIComponent(document.URL)); return false;"><img src="http://simpleobjects.io/public/images/simple_icons_black/Email.png"></a></li>
</ul>

</article>

<aside class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="http://vpfaulkner.github.io//2015/09/30/io-in-ruby/">
            IO in Ruby
            <small><time datetime="2015-09-30T00:00:00-04:00">30 Sep 2015</time></small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="http://vpfaulkner.github.io//2015/09/21/developer-to-engineer/">
            Developer to Engineer
            <small><time datetime="2015-09-21T00:00:00-04:00">21 Sep 2015</time></small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="http://vpfaulkner.github.io//2015/09/14/keyword-arguments-in-ruby/">
            Keyword Arguments in Ruby
            <small><time datetime="2015-09-14T00:00:00-04:00">14 Sep 2015</time></small>
          </a>
        </h3>
      </li>
    
  </ul>
</aside>

        

      </main>

      <footer class="footer">
        <small>
          &copy; <time datetime="2015-09-30T08:28:41-04:00">2015</time>. All rights reserved.
        </small>
      </footer>
    </div>

  </body>
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-60674340-1', 'auto');
    ga('send', 'pageview');

</script>

</html>
