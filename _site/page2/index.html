<!DOCTYPE html>
<html lang="en">

    <div class="sidebar" id="sidebar">
  <div class="about_me">
    <h3>Recent Posts</h3>
      
        <a href=" /2015/02/09/what-are-key-value-stores/ "> What are Key Value Stores? </a><br>
      
        <a href=" /2015/02/04/sidekiq-in-rails/ "> Sidekiq in Rails </a><br>
      
        <a href=" /2015/02/01/conways-law/ "> Conway's Law </a><br>
      
        <a href=" /2015/01/26/control-flow-in-ruby/ "> Control Flow in Ruby Pt. I </a><br>
      
        <a href=" /2015/01/22/make-your-ruby-objects-single-minded/ "> Make your Ruby Objects Single-Minded </a><br>
      

    <br>
    <br>
    <br>
    <div class="about-me-sidebar">
      <p><span style="font-weight: bolder">Vance Faulkner</span> is a Ruby on
      Rails developer from Durham, NC</p>
      <a href="https://github.com/vpfaulkner"><i class="fa fa-github"></i></a>
      <a href="https://www.linkedin.com/in/vancefaulkner"><i class="fa fa-linkedin-square"></i></a>
      <a href="mailto:vpfaulkner@gmail.com"><i class="fa fa-envelope-o"></i></a>
    </div>
  </div>
</div>

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">

  <meta http-equiv='Content-Type' content='text/html; charset=utf-8' />
  
  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Wrong Abstraction &middot; Ruby Developer
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="http://vpfaulkner.github.io/public/css/poole.css">
  <link rel="stylesheet" href="http://vpfaulkner.github.io/public/css/syntax.css">
  <link href='http://fonts.googleapis.com/css?family=Lora' rel='stylesheet'
  type='text/css'>

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://vpfaulkner.github.io/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="http://vpfaulkner.github.io/public/favicon.ico">
  <link rel="stylesheet" href="/public/font-awesome-4.3.0/css/font-awesome.min.css">

  <!-- RSS -->
  <link rel="alternate" type="application/atom+xml" title="Wrong Abstraction" href="http://vpfaulkner.github.io/atom.xml">
</head>


  <body>


    <div class="container content">
      <header class="masthead">
        <h3 class="masthead-title">
          <a href="http://vpfaulkner.github.io/" title="Home"><i class="fa
          fa-paper-plane"></i><span style="margin-left: .75rem">Wrong Abstraction</span></a>

          
             &nbsp;&nbsp;&nbsp;
             <small><a href="/about_me">About Me</a></small>
          
             &nbsp;&nbsp;&nbsp;
             <small><a href="/playbook">Playbook</a></small>
          
             &nbsp;&nbsp;&nbsp;
             <small><a href="/archive">Archive</a></small>
          

        </h3>
      </header>

      <main>
        <div class="posts">
  
  <article class="post">
    <h1 class="post-title">
      <a href="/2015/02/04/sidekiq-in-rails/">
        Sidekiq in Rails
      </a>
    </h1>

    <time datetime="2015-02-04T00:00:00-05:00" class="post-date">04 Feb 2015</time>

    <p>If you’re looking to run a background job in Ruby, one tool that I have found very easy to work with is Sidekiq. First off, how to use it:</p>

<p>Begin by adding it to your Gemfile:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">gem</span> <span class="s1">&#39;sidekiq&#39;</span></code></pre></div>

<p>Install:</p>

<div class="highlight"><pre><code class="language-sh" data-lang="sh">bundle install</code></pre></div>

<p>Define the job you need done with a perform method:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/workers/email_worker.rb</span>
<span class="k">class</span> <span class="nc">EmailWorker</span>
  <span class="kp">include</span> <span class="no">Sidekiq</span><span class="o">::</span><span class="no">Worker</span>

  <span class="k">def</span> <span class="nf">perform</span><span class="p">(</span><span class="n">email</span><span class="p">)</span>
    <span class="c1"># Email logic</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></div>

<p>And call the worker where appropriate</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">RegistrationController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

  <span class="k">def</span> <span class="nf">register</span>
    <span class="c1"># Registation Logic</span>
    <span class="no">EmailWorker</span><span class="o">.</span><span class="n">perform_async</span><span class="p">(</span><span class="n">current_user</span><span class="o">.</span><span class="n">email</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></div>

<p>Get the Sidekiq process going from the shell in your root directory:</p>

<div class="highlight"><pre><code class="language-sh" data-lang="sh">bundle <span class="nb">exec </span>sidekiq</code></pre></div>

<p>Beyond knowing how to do Sidekiq for background processing, the question remains for when to use it. </p>

<p>For me Sidekiq (or any background job) is a trade-off of control and reliability for speed. Testing workers can be very difficult and trying to incorporate a complex workflow where certain actions must be kickedoff after the completion of multiple asynchronous processes can be unstable. Furthermore, it has an issue of thread saftey meaning you must use libraries in Sidekiq that are considered thread safe. For those whom this is a deal-breaker by the way, one other alternative is, <a href="https://github.com/resque/resque">Resque</a> which is a little slower but doesn’t require thread-safe code.</p>

<p>However, for a lot of situations such as the one here that involves sending an email in the background after registration, using a background job such as Sidekiq is perfect. In this case, any additional registration logic you want done does not have to wait for the email to be sent; furthermore, if you need to several things at once (such as emailing a larger mailing list) than doing that work in the background will allow you to make huge gains in speed.</p>

  </article>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="http://vpfaulkner.github.io/page3">Older</a>
  
  
    
      <a class="pagination-item newer" href="http://vpfaulkner.github.io/">Newer</a>
    
  
</div>

        

      </main>

      <footer class="footer">
        <small>
          &copy; <time datetime="2015-02-09T08:13:01-05:00">2015</time>. All rights reserved.
        </small>
      </footer>
    </div>

  </body>
</html>
